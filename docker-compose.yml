# File: docker-compose.yml
# Description: Docker Compose configuration for local development environment
# Dependencies: Postgres, Seq, Identity Server
# Created: 2026-03-01

services:
  postgres:
    image: postgres:15-alpine
    container_name: music_postgres
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: admin
      POSTGRES_DB: musicidentity
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped

  seq:
    image: datalust/seq:latest
    container_name: music_seq
    environment:
      ACCEPT_EULA: Y
    ports:
      - "5341:80"
      - "5342:5341"
    restart: unless-stopped

  identity-server:
    build:
      context: ./Innowise.MusicIdentityServer
      dockerfile: Dockerfile
    container_name: music_identity_server
    depends_on:
      - postgres
      - seq
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_HTTP_PORTS=8080
      - ConnectionStrings__PostgresAppDbConnection=Server=postgres;Port=5432;Database=musicidentity;User Id=admin;Password=admin
      - Serilog__WriteTo__1__Args__serverUrl=http://seq:5341
    ports:
      - "5236:8080" # Mapping to launchSettings.json port
    restart: unless-stopped

volumes:
  postgres_data:
